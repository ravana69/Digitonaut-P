var Phenomenon=function(){"use strict";var e=function(){var e=this;this.resize=function(){var r=e.gl,t=e.canvas,i=e.devicePixelRatio,n=e.position;t.width=t.clientWidth*i,t.height=t.clientHeight*i;var a=r.drawingBufferWidth,o=r.drawingBufferHeight,s=a/o;r.viewport(0,0,a,o);var u=.41421356237309503,f=[1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,(1>s?1:s)*-n.z,1];e.uniforms.uProjectionMatrix={type:"mat4",value:[.5/u,0,0,0,0,s/u*.5,0,0,0,0,-100.001/99.999,-1,0,0,.001/99.999*-200,0]},e.uniforms.uViewMatrix={type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},e.uniforms.uModelMatrix={type:"mat4",value:f}},this.toggle=function(r){r!==e.shouldRender&&(e.shouldRender=void 0!==r?r:!e.shouldRender,e.shouldRender&&e.render())},this.render=function(){e.gl.clear(16640),e.willRender&&e.willRender(e),e.instances.forEach(function(r){r.render(e.uniforms)}),e.didRender&&e.didRender(e),e.shouldRender&&requestAnimationFrame(e.render)},this.add=function(r,t){t.uniforms=t.uniforms||{},t.uniforms=Object.assign(t.uniforms,JSON.parse(JSON.stringify(e.uniforms))),Object.assign(t,{gl:e.gl,uniformMap:e.uniformMap});var i=new function(e){var r=this;this.compileShader=function(e,t){var i=r.gl.createShader(e);return r.gl.shaderSource(i,t),r.gl.compileShader(i),i},this.prepareProgram=function(){var e=r.gl,t=r.vertex,i=r.fragment,n=r.compileShader,a=e.createProgram();e.attachShader(a,n(35633,t,e)),e.attachShader(a,n(35632,i,e)),e.linkProgram(a),e.useProgram(a),r.program=a},this.prepareUniforms=function(){for(var e=Object.keys(r.uniforms),t=0;e.length>t;t+=1){var i=r.gl.getUniformLocation(r.program,e[t]);r.uniforms[e[t]].location=i}},this.prepareAttributes=function(){var e=r.geometry,t=r.attributes,i=r.multiplier,n=e.vertices,a=e.normal,o=["x","y","z"];void 0!==n&&r.attributes.push({name:"aPosition",size:3}),void 0!==a&&r.attributes.push({name:"aNormal",size:3});for(var s=0;t.length>s;s+=1){for(var u=t[s],f=new Float32Array(i*n.length*u.size),l=0;i>l;l+=1)for(var c=u.data&&u.data(l,i),d=l*n.length*u.size,h=0;n.length>h;h+=1)for(var m=0;u.size>m;m+=1){var g=r.modifiers[u.name];f[(d+=1)-1]=void 0!==g?g(c,h,m,r):"aPosition"===u.name?n[h][o[m]]:"aNormal"===u.name?a[h][o[m]]:c[m]}r.attributes[s].data=f}},this.prepareBuffers=function(){r.buffers=[];for(var e=0;r.attributes.length>e;e+=1){var t=r.attributes[e],i=t.data,n=t.name,a=t.size,o=r.gl.createBuffer();r.gl.bindBuffer(34962,o),r.gl.bufferData(34962,i,35044);var s=r.gl.getAttribLocation(r.program,n);r.gl.enableVertexAttribArray(s),r.gl.vertexAttribPointer(s,a,5126,!1,!1,0),r.buffers.push({buffer:o,location:s,size:a})}},this.render=function(e){var t=r.uniforms,i=r.multiplier,n=r.gl;n.useProgram(r.program),r.willRender&&r.willRender(r);for(var a=0;r.buffers.length>a;a+=1){var o=r.buffers[a],s=o.location,u=o.buffer,f=o.size;n.enableVertexAttribArray(s),n.bindBuffer(34962,u),n.vertexAttribPointer(s,f,5126,!1,!1,0)}Object.keys(e).forEach(function(r){t[r].value=e[r].value}),Object.keys(t).forEach(function(e){var i=t[e];r.uniformMap[i.type](i.location,i.value)}),n.drawArrays(r.mode,0,i*r.geometry.vertices.length),r.didRender&&r.didRender(r)},this.destroy=function(){for(var e=0;r.buffers.length>e;e+=1)r.gl.deleteBuffer(r.buffers.buffer);r.gl.deleteProgram(r.program),r.gl=null},Object.assign(this,{uniforms:{},geometry:{vertices:[{x:0,y:0,z:0}]},mode:0,modifiers:{}}),Object.assign(this,e),this.prepareProgram(),this.prepareUniforms(),this.prepareAttributes(),this.prepareBuffers()}(t);e.instances.set(r,i)},this.remove=function(r){var t=e.instances.get(r);void 0!==t&&(t.destroy(),e.instances.delete(r))},this.destroy=function(){e.instances.forEach(function(r,t){r.destroy(),e.instances.delete(t)})}};return function(r){var t=r.canvas,i=void 0===t?document.querySelector("canvas"):t,n=r.context,a=void 0===n?{}:n,o=r.settings,s=void 0===o?{}:o;e.call(this);var u=i.getContext("webgl",Object.assign({alpha:!1,antialias:!1},a));Object.assign(this,{gl:u,canvas:i,uniforms:{},instances:new Map,shouldRender:!0}),Object.assign(this,{devicePixelRatio:1,clearColor:[1,1,1,1],position:{x:0,y:0,z:2}}),Object.assign(this,s),this.uniformMap={float:function(e,r){return u.uniform1f(e,r)},vec2:function(e,r){return u.uniform2fv(e,r)},vec3:function(e,r){return u.uniform3fv(e,r)},vec4:function(e,r){return u.uniform4fv(e,r)},mat2:function(e,r){return u.uniformMatrix2fv(e,!1,r)},mat3:function(e,r){return u.uniformMatrix3fv(e,!1,r)},mat4:function(e,r){return u.uniformMatrix4fv(e,!1,r)}},u.enable(u.DEPTH_TEST),u.depthFunc(u.LEQUAL),!1===u.getContextAttributes().alpha&&(u.clearColor.apply(u,this.clearColor),u.clearDepth(1)),window.addEventListener("resize",this.resize),this.resize(),this.render()}}();